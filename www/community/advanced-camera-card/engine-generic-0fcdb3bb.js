import{eo as e,eD as t,eE as i,l as n,er as s,en as a,el as r,j as l}from"./card-04eb008a.js";const c=(e,t,i)=>"preset"===t?(i?.preset?e.ptz.presets?.[i.preset]:null)??null:i?.phase?e.ptz[`actions_${t}_${i.phase}`]??null:e.ptz[`actions_${t}`]??null,o=(e,t,i)=>!!c(e,t,i),u=(t,i)=>{const n=o(t,i,{phase:"start"})&&o(t,i,{phase:"stop"}),s=o(t,i);return n||s?[...n?[e.Continuous]:[],...s?[e.Relative]:[]]:null},g=e=>{const t=u(e,"left"),i=u(e,"right"),n=u(e,"up"),s=u(e,"down"),a=u(e,"zoom_in"),r=u(e,"zoom_out"),l=e.ptz.presets?Object.keys(e.ptz.presets):void 0;return t?.length||i?.length||n?.length||s?.length||a?.length||r?.length||l?.length?{...t?{left:t}:{},...i?{right:i}:{},...n?{up:n}:{},...s?{down:s}:{},...a?{zoomIn:a}:{},...r?{zoomOut:r}:{},...l?{presets:l}:{}}:null};class h{constructor(e,i,n){this._destroyCallbacks=[],this._stateChangeHandler=e=>{this._eventCallback?.({cameraID:this.getID(),type:t(e.newState.state)?"new":"end"})},this._config=e,this._engine=i,this._capabilities=n?.capabilities,this._eventCallback=n?.eventCallback}async initialize(e){return this._subscribeBasedOnCapabilities(e.stateWatcher),this._onDestroy((()=>e.stateWatcher.unsubscribe(this._stateChangeHandler))),this}async destroy(){this._destroyCallbacks.forEach((e=>e()))}getConfig(){return this._config}setID(e){this._config.id=e}getID(){if(this._config.id)return this._config.id;throw new i(n("error.no_camera_id"))}getEngine(){return this._engine}getCapabilities(){return this._capabilities??null}getProxyConfig(){return{live:"auto"===this._config.proxy.live?"go2rtc"===this._config.live_provider&&!!this._config.go2rtc?.url:this._config.proxy.live,media:"auto"!==this._config.proxy.media&&this._config.proxy.media,dynamic:this._config.proxy.dynamic,ssl_verification:!1!==this._config.proxy.ssl_verification,ssl_ciphers:"auto"===this._config.proxy.ssl_ciphers?"default":this._config.proxy.ssl_ciphers}}async executePTZAction(e,t,i){const n=c(this.getConfig(),t,i);return!!n&&(await e.executeActions({actions:n}),!0)}_onDestroy(e){this._destroyCallbacks.push(e)}_subscribeBasedOnCapabilities(e){this._capabilities?.has("trigger")&&(e.unsubscribe(this._stateChangeHandler),e.subscribe(this._stateChangeHandler,this._config.triggers.entities))}}const _=(e,t)=>{const i=t?.url??e.go2rtc?.url,n=t?.stream??e.go2rtc?.stream;if(!i||!n)return null;const s=`${i}/api/ws?src=${n}`;return{endpoint:s,sign:s.startsWith("/")}};class d{constructor(e,t){this._stateWatcher=e,this._eventCallback=t}getEngineType(){return s.Generic}async createCamera(e,t){return await new h(t,this,{capabilities:new a({"favorite-events":!1,"favorite-recordings":!1,"remote-control-entity":!0,clips:!1,live:!0,menu:!0,recordings:!1,seek:!1,snapshots:!1,substream:!0,trigger:!0,ptz:g(t)??void 0},{disable:t.capabilities?.disable,disableExcept:t.capabilities?.disable_except}),eventCallback:this._eventCallback}).initialize({stateWatcher:this._stateWatcher})}generateDefaultEventQuery(e,t,i){return null}generateDefaultRecordingQuery(e,t,i){return null}generateDefaultRecordingSegmentsQuery(e,t,i){return null}async getEvents(e,t,i,n){return null}async getRecordings(e,t,i,n){return null}async getRecordingSegments(e,t,i,n){return null}generateMediaFromEvents(e,t,i,n){return null}generateMediaFromRecordings(e,t,i,n){return null}async getMediaDownloadPath(e,t,i){return null}async favoriteMedia(e,t,i,n){}getQueryResultMaxAge(e){return null}async getMediaSeekTime(e,t,i,n,s){return null}async getMediaMetadata(e,t,i,n){return null}getCameraMetadata(e,t){const i=r(t);return{title:t.title??l(e,t.camera_entity)??l(e,t.webrtc_card?.entity)??t.id??"",icon:{entity:i??void 0,icon:t.icon,fallback:"mdi:video"}}}getMediaCapabilities(e){return null}getCameraEndpoints(e,t){const i=_(e),n=(()=>{const t=e.camera_entity?e.camera_entity:null;return t?{endpoint:t}:null})();return i||n?{...i&&{go2rtc:i},...n&&{webrtcCard:n}}:null}}var p=Object.freeze({__proto__:null,GenericCameraManagerEngine:d});export{h as C,d as G,_ as a,p as e,g};
