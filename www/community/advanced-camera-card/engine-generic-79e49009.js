import{eB as e,em as t,eC as n,l as i,ep as s,el as a,ej as r,j as l}from"./card-ab16aecd.js";const c=(e,t,n)=>"preset"===t?(n?.preset?e.ptz.presets?.[n.preset]:null)??null:n?.phase?e.ptz[`actions_${t}_${n.phase}`]??null:e.ptz[`actions_${t}`]??null,o=(e,t,n)=>!!c(e,t,n),u=(e,n)=>{const i=o(e,n,{phase:"start"})&&o(e,n,{phase:"stop"}),s=o(e,n);return i||s?[...i?[t.Continuous]:[],...s?[t.Relative]:[]]:null},g=e=>{const t=u(e,"left"),n=u(e,"right"),i=u(e,"up"),s=u(e,"down"),a=u(e,"zoom_in"),r=u(e,"zoom_out"),l=e.ptz.presets?Object.keys(e.ptz.presets):void 0;return t?.length||n?.length||i?.length||s?.length||a?.length||r?.length||l?.length?{...t?{left:t}:{},...n?{right:n}:{},...i?{up:i}:{},...s?{down:s}:{},...a?{zoomIn:a}:{},...r?{zoomOut:r}:{},...l?{presets:l}:{}}:null};class h{constructor(t,n,i){this._destroyCallbacks=[],this._stateChangeHandler=t=>{var n;this._eventCallback?.({cameraID:this.getID(),type:(n=t.newState.state,n&&e.includes(n)?"new":"end")})},this._config=t,this._engine=n,this._capabilities=i?.capabilities,this._eventCallback=i?.eventCallback}async initialize(e){return this._capabilities?.has("trigger")&&e.stateWatcher.subscribe(this._stateChangeHandler,this._config.triggers.entities),this._onDestroy((()=>e.stateWatcher.unsubscribe(this._stateChangeHandler))),this}async destroy(){this._destroyCallbacks.forEach((e=>e()))}getConfig(){return this._config}setID(e){this._config.id=e}getID(){if(this._config.id)return this._config.id;throw new n(i("error.no_camera_id"))}getEngine(){return this._engine}getCapabilities(){return this._capabilities??null}getProxyConfig(){return{dynamic:this._config.proxy.dynamic,media:"auto"!==this._config.proxy.media&&this._config.proxy.media,ssl_verification:!1!==this._config.proxy.ssl_verification,ssl_ciphers:"auto"===this._config.proxy.ssl_ciphers?"default":this._config.proxy.ssl_ciphers}}async executePTZAction(e,t,n){const i=c(this.getConfig(),t,n);return!!i&&(await e.executeActions({actions:i}),!0)}_onDestroy(e){this._destroyCallbacks.push(e)}}const d=(e,t)=>{const n=t?.url??e.go2rtc?.url,i=t?.stream??e.go2rtc?.stream;if(!n||!i)return null;const s=`${n}/api/ws?src=${i}`;return{endpoint:s,sign:s.startsWith("/")}};class p{constructor(e,t){this._stateWatcher=e,this._eventCallback=t}getEngineType(){return s.Generic}async createCamera(e,t){return await new h(t,this,{capabilities:new a({"favorite-events":!1,"favorite-recordings":!1,"remote-control-entity":!0,clips:!1,live:!0,menu:!0,recordings:!1,seek:!1,snapshots:!1,substream:!0,trigger:!0,ptz:g(t)??void 0},{disable:t.capabilities?.disable,disableExcept:t.capabilities?.disable_except}),eventCallback:this._eventCallback}).initialize({stateWatcher:this._stateWatcher})}generateDefaultEventQuery(e,t,n){return null}generateDefaultRecordingQuery(e,t,n){return null}generateDefaultRecordingSegmentsQuery(e,t,n){return null}async getEvents(e,t,n,i){return null}async getRecordings(e,t,n,i){return null}async getRecordingSegments(e,t,n,i){return null}generateMediaFromEvents(e,t,n,i){return null}generateMediaFromRecordings(e,t,n,i){return null}async getMediaDownloadPath(e,t,n){return null}async favoriteMedia(e,t,n,i){}getQueryResultMaxAge(e){return null}async getMediaSeekTime(e,t,n,i,s){return null}async getMediaMetadata(e,t,n,i){return null}getCameraMetadata(e,t){const n=r(t);return{title:t.title??l(e,t.camera_entity)??l(e,t.webrtc_card?.entity)??t.id??"",icon:{entity:n??void 0,icon:t.icon,fallback:"mdi:video"}}}getMediaCapabilities(e){return null}getCameraEndpoints(e,t){const n=d(e),i=(()=>{const t=e.camera_entity?e.camera_entity:null;return t?{endpoint:t}:null})();return n||i?{...n&&{go2rtc:n},...i&&{webrtcCard:i}}:null}}var _=Object.freeze({__proto__:null,GenericCameraManagerEngine:p});export{h as C,p as G,d as a,_ as e,g};
